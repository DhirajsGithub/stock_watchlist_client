import * as React from "react";
import { LineChart } from "@mui/x-charts/LineChart";
import { useParams } from "react-router-dom";
import { Box, CssBaseline, Typography } from "@mui/material";
import axios from "axios";
import { alphaVantageUrl } from "../utils/baseUrl";
import { alphaVantageApiKey } from "../utils/baseUrl";
import { useState } from "react";

interface timeProps {
    name: string[];
}
interface timeSeriesProps {
    time: timeProps[];
}

interface stockDetailsProps {
    ["Meta Data"]: string;
    ["Time Series (5min)"]: timeSeriesProps;
}

export default function StockDetail() {
    const { symbol } = useParams<{ symbol: string }>();
    const [stockDetail, setStockDetail] = useState([]);
    const [timeDataSeries, setTimeDataSeries] = useState([]);
    const [openSeries, setOpenSeries] = useState([]);
    const [closeSeries, setCloseSeries] = useState([]);
    const [highSeries, setHighSeries] = useState([]);
    const [lowSeries, setLowSeries] = useState([]);
    const [volumeSeries, setVolumeSeries] = useState([]);

    const fetchStockDetails = async () => {
        // let res = await axios.get(alphaVantageUrl + `/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${alphaVantageApiKey}`)
        // console.log(res)
        const timeSeries = {
            "2024-05-15 19:00:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "202",
            },
            "2024-05-15 18:30:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "202",
            },
            "2024-05-15 18:10:00": {
                "1. open": "36.6700",
                "2. high": "36.6700",
                "3. low": "36.6700",
                "4. close": "36.6700",
                "5. volume": "2",
            },
            "2024-05-15 18:05:00": {
                "1. open": "36.0000",
                "2. high": "36.6700",
                "3. low": "36.0000",
                "4. close": "36.4200",
                "5. volume": "7",
            },
            "2024-05-15 17:50:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "1",
            },
            "2024-05-15 16:10:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "202",
            },
            "2024-05-15 16:05:00": {
                "1. open": "36.6300",
                "2. high": "36.6300",
                "3. low": "36.6300",
                "4. close": "36.6300",
                "5. volume": "1",
            },
            "2024-05-15 16:00:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "704",
            },
            "2024-05-15 15:55:00": {
                "1. open": "36.6000",
                "2. high": "36.6100",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "1236",
            },
            "2024-05-15 15:50:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.5900",
                "4. close": "36.6000",
                "5. volume": "1815",
            },
            "2024-05-15 15:45:00": {
                "1. open": "36.5980",
                "2. high": "36.6050",
                "3. low": "36.5900",
                "4. close": "36.6050",
                "5. volume": "1178",
            },
            "2024-05-15 15:40:00": {
                "1. open": "36.5900",
                "2. high": "36.5900",
                "3. low": "36.5900",
                "4. close": "36.5900",
                "5. volume": "258",
            },
            "2024-05-15 15:35:00": {
                "1. open": "36.5900",
                "2. high": "36.5900",
                "3. low": "36.5800",
                "4. close": "36.5900",
                "5. volume": "1010",
            },
            "2024-05-15 15:30:00": {
                "1. open": "36.5900",
                "2. high": "36.6000",
                "3. low": "36.5800",
                "4. close": "36.5900",
                "5. volume": "2958",
            },
            "2024-05-15 15:25:00": {
                "1. open": "36.5800",
                "2. high": "36.5800",
                "3. low": "36.5800",
                "4. close": "36.5800",
                "5. volume": "309",
            },
            "2024-05-15 15:20:00": {
                "1. open": "36.5960",
                "2. high": "36.5960",
                "3. low": "36.5770",
                "4. close": "36.5770",
                "5. volume": "743",
            },
            "2024-05-15 15:10:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.5910",
                "4. close": "36.5910",
                "5. volume": "240",
            },
            "2024-05-15 15:05:00": {
                "1. open": "36.5800",
                "2. high": "36.5800",
                "3. low": "36.5500",
                "4. close": "36.5500",
                "5. volume": "591",
            },
            "2024-05-15 15:00:00": {
                "1. open": "36.5310",
                "2. high": "36.5310",
                "3. low": "36.5310",
                "4. close": "36.5310",
                "5. volume": "847",
            },
            "2024-05-15 14:55:00": {
                "1. open": "36.6200",
                "2. high": "36.6200",
                "3. low": "36.6200",
                "4. close": "36.6200",
                "5. volume": "140",
            },
            "2024-05-15 14:50:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "208",
            },
            "2024-05-15 14:45:00": {
                "1. open": "36.6200",
                "2. high": "36.6200",
                "3. low": "36.6000",
                "4. close": "36.6000",
                "5. volume": "911",
            },
            "2024-05-15 14:40:00": {
                "1. open": "36.6200",
                "2. high": "36.6300",
                "3. low": "36.6200",
                "4. close": "36.6200",
                "5. volume": "758",
            },
            "2024-05-15 14:35:00": {
                "1. open": "36.6200",
                "2. high": "36.6200",
                "3. low": "36.6200",
                "4. close": "36.6200",
                "5. volume": "202",
            },
            "2024-05-15 14:30:00": {
                "1. open": "36.5900",
                "2. high": "36.5900",
                "3. low": "36.5900",
                "4. close": "36.5900",
                "5. volume": "283",
            },
            "2024-05-15 14:25:00": {
                "1. open": "36.6200",
                "2. high": "36.6200",
                "3. low": "36.5750",
                "4. close": "36.5750",
                "5. volume": "484",
            },
            "2024-05-15 14:20:00": {
                "1. open": "36.5900",
                "2. high": "36.5900",
                "3. low": "36.5900",
                "4. close": "36.5900",
                "5. volume": "731",
            },
            "2024-05-15 14:15:00": {
                "1. open": "36.5700",
                "2. high": "36.6300",
                "3. low": "36.5700",
                "4. close": "36.5710",
                "5. volume": "1772",
            },
            "2024-05-15 14:10:00": {
                "1. open": "36.6300",
                "2. high": "36.6300",
                "3. low": "36.6300",
                "4. close": "36.6300",
                "5. volume": "100",
            },
            "2024-05-15 14:05:00": {
                "1. open": "36.5900",
                "2. high": "36.6200",
                "3. low": "36.5900",
                "4. close": "36.6100",
                "5. volume": "1268",
            },
            "2024-05-15 14:00:00": {
                "1. open": "36.6000",
                "2. high": "36.6000",
                "3. low": "36.5400",
                "4. close": "36.5400",
                "5. volume": "731",
            },
            "2024-05-15 13:55:00": {
                "1. open": "36.5610",
                "2. high": "36.5800",
                "3. low": "36.5550",
                "4. close": "36.5800",
                "5. volume": "775",
            },
            "2024-05-15 13:50:00": {
                "1. open": "36.5710",
                "2. high": "36.5710",
                "3. low": "36.5710",
                "4. close": "36.5710",
                "5. volume": "400",
            },
            "2024-05-15 13:40:00": {
                "1. open": "36.5500",
                "2. high": "36.5590",
                "3. low": "36.5400",
                "4. close": "36.5590",
                "5. volume": "1875",
            },
            "2024-05-15 13:30:00": {
                "1. open": "36.5400",
                "2. high": "36.5400",
                "3. low": "36.5400",
                "4. close": "36.5400",
                "5. volume": "803",
            },
            "2024-05-15 13:25:00": {
                "1. open": "36.5500",
                "2. high": "36.5500",
                "3. low": "36.5300",
                "4. close": "36.5300",
                "5. volume": "517",
            },
            "2024-05-15 13:20:00": {
                "1. open": "36.5600",
                "2. high": "36.5600",
                "3. low": "36.5600",
                "4. close": "36.5600",
                "5. volume": "319",
            },
            "2024-05-15 13:15:00": {
                "1. open": "36.5000",
                "2. high": "36.5600",
                "3. low": "36.5000",
                "4. close": "36.5600",
                "5. volume": "3336",
            },
            "2024-05-15 13:10:00": {
                "1. open": "36.5000",
                "2. high": "36.5000",
                "3. low": "36.5000",
                "4. close": "36.5000",
                "5. volume": "150",
            },
            "2024-05-15 13:05:00": {
                "1. open": "36.4910",
                "2. high": "36.4910",
                "3. low": "36.4900",
                "4. close": "36.4900",
                "5. volume": "328",
            },
            "2024-05-15 13:00:00": {
                "1. open": "36.4800",
                "2. high": "36.4800",
                "3. low": "36.4800",
                "4. close": "36.4800",
                "5. volume": "1462",
            },
            "2024-05-15 12:55:00": {
                "1. open": "36.4700",
                "2. high": "36.4700",
                "3. low": "36.4700",
                "4. close": "36.4700",
                "5. volume": "200",
            },
            "2024-05-15 12:50:00": {
                "1. open": "36.4680",
                "2. high": "36.4680",
                "3. low": "36.4650",
                "4. close": "36.4650",
                "5. volume": "346",
            },
            "2024-05-15 12:45:00": {
                "1. open": "36.4600",
                "2. high": "36.4600",
                "3. low": "36.4600",
                "4. close": "36.4600",
                "5. volume": "297",
            },
            "2024-05-15 12:30:00": {
                "1. open": "36.4600",
                "2. high": "36.4600",
                "3. low": "36.4600",
                "4. close": "36.4600",
                "5. volume": "300",
            },
            "2024-05-15 12:25:00": {
                "1. open": "36.4500",
                "2. high": "36.4500",
                "3. low": "36.4500",
                "4. close": "36.4500",
                "5. volume": "402",
            },
            "2024-05-15 12:15:00": {
                "1. open": "36.4400",
                "2. high": "36.4400",
                "3. low": "36.4300",
                "4. close": "36.4400",
                "5. volume": "1308",
            },
            "2024-05-15 12:10:00": {
                "1. open": "36.4500",
                "2. high": "36.4500",
                "3. low": "36.4500",
                "4. close": "36.4500",
                "5. volume": "300",
            },
            "2024-05-15 12:05:00": {
                "1. open": "36.4500",
                "2. high": "36.4500",
                "3. low": "36.4400",
                "4. close": "36.4400",
                "5. volume": "594",
            },
            "2024-05-15 12:00:00": {
                "1. open": "36.4700",
                "2. high": "36.4700",
                "3. low": "36.4360",
                "4. close": "36.4500",
                "5. volume": "811",
            },
            "2024-05-15 11:55:00": {
                "1. open": "36.4700",
                "2. high": "36.4800",
                "3. low": "36.4700",
                "4. close": "36.4800",
                "5. volume": "537",
            },
            "2024-05-15 11:40:00": {
                "1. open": "36.4790",
                "2. high": "36.4790",
                "3. low": "36.4260",
                "4. close": "36.4700",
                "5. volume": "1211",
            },
            "2024-05-15 11:35:00": {
                "1. open": "36.4740",
                "2. high": "36.4740",
                "3. low": "36.4740",
                "4. close": "36.4740",
                "5. volume": "251",
            },
            "2024-05-15 11:30:00": {
                "1. open": "36.4500",
                "2. high": "36.4800",
                "3. low": "36.4500",
                "4. close": "36.4790",
                "5. volume": "1405",
            },
            "2024-05-15 11:25:00": {
                "1. open": "36.4300",
                "2. high": "36.4690",
                "3. low": "36.4300",
                "4. close": "36.4690",
                "5. volume": "1217",
            },
            "2024-05-15 11:20:00": {
                "1. open": "36.4700",
                "2. high": "36.4700",
                "3. low": "36.4600",
                "4. close": "36.4600",
                "5. volume": "400",
            },
            "2024-05-15 11:15:00": {
                "1. open": "36.4550",
                "2. high": "36.4600",
                "3. low": "36.4550",
                "4. close": "36.4600",
                "5. volume": "221",
            },
            "2024-05-15 11:05:00": {
                "1. open": "36.4400",
                "2. high": "36.4400",
                "3. low": "36.4400",
                "4. close": "36.4400",
                "5. volume": "363",
            },
            "2024-05-15 11:00:00": {
                "1. open": "36.4300",
                "2. high": "36.4600",
                "3. low": "36.4300",
                "4. close": "36.4550",
                "5. volume": "2870",
            },
            "2024-05-15 10:50:00": {
                "1. open": "36.4150",
                "2. high": "36.4200",
                "3. low": "36.4150",
                "4. close": "36.4200",
                "5. volume": "670",
            },
            "2024-05-15 10:45:00": {
                "1. open": "36.4200",
                "2. high": "36.4200",
                "3. low": "36.4200",
                "4. close": "36.4200",
                "5. volume": "214",
            },
            "2024-05-15 10:40:00": {
                "1. open": "36.4280",
                "2. high": "36.4280",
                "3. low": "36.3900",
                "4. close": "36.4110",
                "5. volume": "1066",
            },
            "2024-05-15 10:35:00": {
                "1. open": "36.4080",
                "2. high": "36.4080",
                "3. low": "36.4080",
                "4. close": "36.4080",
                "5. volume": "200",
            },
            "2024-05-15 10:30:00": {
                "1. open": "36.3500",
                "2. high": "36.4000",
                "3. low": "36.3500",
                "4. close": "36.4000",
                "5. volume": "1338",
            },
            "2024-05-15 10:25:00": {
                "1. open": "36.3900",
                "2. high": "36.3900",
                "3. low": "36.3900",
                "4. close": "36.3900",
                "5. volume": "183",
            },
            "2024-05-15 10:20:00": {
                "1. open": "36.4200",
                "2. high": "36.4200",
                "3. low": "36.3900",
                "4. close": "36.4000",
                "5. volume": "620",
            },
            "2024-05-15 10:15:00": {
                "1. open": "36.4100",
                "2. high": "36.4200",
                "3. low": "36.3900",
                "4. close": "36.4000",
                "5. volume": "1976",
            },
            "2024-05-15 10:10:00": {
                "1. open": "36.4000",
                "2. high": "36.4000",
                "3. low": "36.4000",
                "4. close": "36.4000",
                "5. volume": "300",
            },
            "2024-05-15 10:05:00": {
                "1. open": "36.4200",
                "2. high": "36.4200",
                "3. low": "36.4200",
                "4. close": "36.4200",
                "5. volume": "323",
            },
            "2024-05-15 10:00:00": {
                "1. open": "36.4050",
                "2. high": "36.4050",
                "3. low": "36.3300",
                "4. close": "36.3300",
                "5. volume": "887",
            },
            "2024-05-15 09:55:00": {
                "1. open": "36.4000",
                "2. high": "36.4000",
                "3. low": "36.3700",
                "4. close": "36.3700",
                "5. volume": "1113",
            },
            "2024-05-15 09:50:00": {
                "1. open": "36.3900",
                "2. high": "36.4000",
                "3. low": "36.3300",
                "4. close": "36.3950",
                "5. volume": "4762",
            },
            "2024-05-15 09:45:00": {
                "1. open": "36.4100",
                "2. high": "36.4130",
                "3. low": "36.2930",
                "4. close": "36.2930",
                "5. volume": "510",
            },
            "2024-05-15 09:40:00": {
                "1. open": "36.3620",
                "2. high": "36.3700",
                "3. low": "36.3620",
                "4. close": "36.3700",
                "5. volume": "481",
            },
            "2024-05-15 09:30:00": {
                "1. open": "36.4800",
                "2. high": "36.4800",
                "3. low": "36.4800",
                "4. close": "36.4800",
                "5. volume": "860",
            },
            "2024-05-15 09:20:00": {
                "1. open": "37.0000",
                "2. high": "37.0000",
                "3. low": "36.4000",
                "4. close": "36.4000",
                "5. volume": "22",
            },
            "2024-05-15 09:00:00": {
                "1. open": "36.3000",
                "2. high": "36.3000",
                "3. low": "36.3000",
                "4. close": "36.3000",
                "5. volume": "2",
            },
            "2024-05-15 08:30:00": {
                "1. open": "36.3000",
                "2. high": "36.5000",
                "3. low": "36.3000",
                "4. close": "36.5000",
                "5. volume": "100",
            },
            "2024-05-15 08:00:00": {
                "1. open": "36.2700",
                "2. high": "36.2700",
                "3. low": "36.2700",
                "4. close": "36.2700",
                "5. volume": "2",
            },
            "2024-05-14 19:00:00": {
                "1. open": "36.2700",
                "2. high": "36.2700",
                "3. low": "36.2700",
                "4. close": "36.2700",
                "5. volume": "316",
            },
            "2024-05-14 18:35:00": {
                "1. open": "36.3000",
                "2. high": "36.3000",
                "3. low": "36.3000",
                "4. close": "36.3000",
                "5. volume": "1",
            },
            "2024-05-14 18:30:00": {
                "1. open": "36.2700",
                "2. high": "36.2700",
                "3. low": "36.2700",
                "4. close": "36.2700",
                "5. volume": "316",
            },
            "2024-05-14 18:20:00": {
                "1. open": "36.3000",
                "2. high": "36.3000",
                "3. low": "36.3000",
                "4. close": "36.3000",
                "5. volume": "1",
            },
            "2024-05-14 16:35:00": {
                "1. open": "36.0800",
                "2. high": "36.0800",
                "3. low": "36.0800",
                "4. close": "36.0800",
                "5. volume": "170",
            },
            "2024-05-14 16:10:00": {
                "1. open": "36.2700",
                "2. high": "36.2700",
                "3. low": "36.2700",
                "4. close": "36.2700",
                "5. volume": "316",
            },
            "2024-05-14 16:00:00": {
                "1. open": "36.2500",
                "2. high": "36.2700",
                "3. low": "36.2500",
                "4. close": "36.2700",
                "5. volume": "832",
            },
            "2024-05-14 15:55:00": {
                "1. open": "36.2600",
                "2. high": "36.2600",
                "3. low": "36.2500",
                "4. close": "36.2500",
                "5. volume": "3911",
            },
            "2024-05-14 15:45:00": {
                "1. open": "36.2600",
                "2. high": "36.2600",
                "3. low": "36.2600",
                "4. close": "36.2600",
                "5. volume": "720",
            },
            "2024-05-14 15:40:00": {
                "1. open": "36.2900",
                "2. high": "36.3000",
                "3. low": "36.2760",
                "4. close": "36.2760",
                "5. volume": "733",
            },
            "2024-05-14 15:35:00": {
                "1. open": "36.2500",
                "2. high": "36.2800",
                "3. low": "36.2500",
                "4. close": "36.2800",
                "5. volume": "476",
            },
            "2024-05-14 15:25:00": {
                "1. open": "36.2370",
                "2. high": "36.2370",
                "3. low": "36.2100",
                "4. close": "36.2300",
                "5. volume": "1146",
            },
            "2024-05-14 15:10:00": {
                "1. open": "36.2100",
                "2. high": "36.2260",
                "3. low": "36.2100",
                "4. close": "36.2260",
                "5. volume": "1000",
            },
            "2024-05-14 15:00:00": {
                "1. open": "36.2300",
                "2. high": "36.2300",
                "3. low": "36.2300",
                "4. close": "36.2300",
                "5. volume": "199",
            },
            "2024-05-14 14:55:00": {
                "1. open": "36.2500",
                "2. high": "36.2500",
                "3. low": "36.2490",
                "4. close": "36.2490",
                "5. volume": "358",
            },
            "2024-05-14 14:45:00": {
                "1. open": "36.2300",
                "2. high": "36.2300",
                "3. low": "36.2300",
                "4. close": "36.2300",
                "5. volume": "630",
            },
            "2024-05-14 14:40:00": {
                "1. open": "36.2250",
                "2. high": "36.2280",
                "3. low": "36.2100",
                "4. close": "36.2100",
                "5. volume": "760",
            },
            "2024-05-14 14:35:00": {
                "1. open": "36.2400",
                "2. high": "36.2600",
                "3. low": "36.2000",
                "4. close": "36.2260",
                "5. volume": "2179",
            },
            "2024-05-14 14:30:00": {
                "1. open": "36.2000",
                "2. high": "36.2000",
                "3. low": "36.2000",
                "4. close": "36.2000",
                "5. volume": "600",
            },
            "2024-05-14 14:25:00": {
                "1. open": "36.2220",
                "2. high": "36.2220",
                "3. low": "36.2220",
                "4. close": "36.2220",
                "5. volume": "342",
            },
            "2024-05-14 14:10:00": {
                "1. open": "36.1800",
                "2. high": "36.2000",
                "3. low": "36.1800",
                "4. close": "36.2000",
                "5. volume": "1589",
            },
        };
        let temp = [];
        const timestamps = Object.keys(timeSeries).reverse(); // reverse to plot in chronological order
        const open = timestamps.map((time) =>
            parseFloat(timeSeries[time]["1. open"])
        );
        const high = timestamps.map((time) =>
            parseFloat(timeSeries[time]["2. high"])
        );
        const low = timestamps.map((time) =>
            parseFloat(timeSeries[time]["3. low"])
        );
        const close = timestamps.map((time) =>
            parseFloat(timeSeries[time]["4. close"])
        );
        const volume = timestamps.map((time) =>
            parseInt(timeSeries[time]["5. volume"], 10)
        );


        const data = timestamps.map((timestamp, index) => ({
            timestamp,
            open: open[index],
            high: high[index],
            low: low[index],
            close: close[index],
            volume: volume[index],
        }));
        setStockDetail(data)
    };

    React.useEffect(() => {
        fetchStockDetails();
    }, [symbol]);
    return (
        <Box
            sx={{
                width: "100%",
                display: "flex",
                justifyContent: "center",
                flexDirection: "column",
                alignItems: "center",
            }}
        >
            <CssBaseline />
            <Typography sx={{ textAlign: "center", width: "100%" }} variant="h3">
                {symbol}
            </Typography>
            <br />
            <LineChart
                xAxis={[{ data: Array.from(Array(100).keys()) }]}
                series={[
                    {
                        data: stockDetail.map((stock) => stock.open),
                        label: "Open",
                    },
                    {
                        data: stockDetail.map((stock) => stock.high),
                        label: "High",
                    },
                    {
                        data: stockDetail.map((stock) => stock.low),
                        label: "Low",
                    },
                    {
                        data: stockDetail.map((stock) => stock.close),
                        label: "Close",
                    },

                ]}
                width={800}
                height={500}
            />


        </Box>
    );
}
